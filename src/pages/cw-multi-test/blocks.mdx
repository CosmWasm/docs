---
tags: ["multitest", "blocks"]
---

import { Callout } from "nextra/components";

[BlockInfo]: https://docs.rs/cosmwasm-std/latest/cosmwasm_std/struct.BlockInfo.html
[block_info]: https://docs.rs/cw-multi-test/latest/cw_multi_test/struct.App.html#method.block_info

# Blocks

There are several cases when testing CosmWasm smart contracts requires simulating delays on the
blockchain, like:

- staking and unstaking processes,
- governance voting periods,
- validator set changes,
- token vesting schedules,
- incentive distribution, or
- IBC packet timeouts.

## Operations on blocks

**`MultiTest`** provides several operations to initialize and update current block properties, such
as height and timestamp, in order to test delays on the blockchain.

<Callout emoji="ðŸš¨">
  Although it is possible to modify **only** the height or **only** the timestamp of the block in
  **`MultiTest`**, this is not feasible in a real-life blockchain and may lead to unpredictable test
  results that do not reflect the blockchain's real-life behavior.
</Callout>

<Callout type="info" emoji="â˜‰">
  Always increment the height **and** the timestamp of the block in tests.
</Callout>

In the following chapters you will find practical examples of several operations on blocks.

## Initialization with the default block

In **`MultiTest`**, the chain is initialized with a default block that has the following properties:

- `height{:rust}`: **12345**,
- `time{:rust}`: **1571797419879305533** (Wed Oct 23 2019 02:23:39 GMT+0000),
- `chain_id{:rust}`: **cosmos-testnet-14002**.

These properties constitute the [BlockInfo] structure, which is defined in the CosmWasm library for
representing block metadata. [BlockInfo] can be retrieved at any point in a test by calling the
[`block_info(){:rust}`][block_info] function provided by `App{:rust}`.

```rust {4, 7} showLineNumbers copy /block_info/ /assert_eq!(12345/ /assert_eq!(1571797419879305533/ /assert_eq!("cosmos-testnet-14002"/
use cw_multi_test::App;

// create the default chain simulator
let app = App::default();

// get the initial block properties
let block = app.block_info();

// default block height is 12345
assert_eq!(12345, block.height);

// default block timestamp is Wed Oct 23 2019 02:23:39 GMT+0000
assert_eq!(1571797419879305533, block.time.nanos());

// default chain identifier is "cosmos-testnet-14002"
assert_eq!("cosmos-testnet-14002", block.chain_id);
```

## Initialization with the custom block

(todo)

- `app.set_block{:rust}`
- `cosmwasm_std::BlockInfo{:rust}`

```rust showLineNumbers {8-12} /set_block/ /BlockInfo/
use cosmwasm_std::{BlockInfo, Timestamp};
use cw_multi_test::App;

// create the default chain simulator
let mut app = App::default();

// create and use a custom block
app.set_block(BlockInfo {
    height: 1,
    time: Timestamp::from_seconds(1723627489),
    chain_id: "starship-testnet".to_string(),
});

// get the custom block properties
let block = app.block_info();

// now the block height is 1
assert_eq!(1, block.height);

// now the block timestamp is Wed Aug 14 2024 09:24:49 GMT+0000
assert_eq!(1723627489, block.time.seconds());

// now the chain identifier is "starship-testnet"
assert_eq!("starship-testnet", block.chain_id);
```

## Generating next block with the default step

(todo)

- what is the default step
- `app.update_block{:rust}`
- `next_block{:rust}`

```rust showLineNumbers {7} /update_block/ /next_block/
use cw_multi_test::{next_block, App};

// create the default chain simulator
let mut app = App::default();

// update the block by `generating` next block
app.update_block(next_block);

// get the current block properties
let block = app.block_info();

// now the block height is 1 after the initial value
assert_eq!(12346, block.height);

// now the block timestamp is 5 seconds after the initial value
// current value is:   Wed Oct 23 2019 02:23:44 GMT+0000
// initial value was:  Wed Oct 23 2019 02:23:39 GMT+0000
assert_eq!(1571797424879305533, block.time.nanos());

// chain identifier remains unchanged
assert_eq!("cosmos-testnet-14002", block.chain_id);
```

## Generating next block with custom step

(todo)

- `app.update_block{:rust}`
- `|block|{}{:rust}`

```rust showLineNumbers {7-10} /update_block/
use cw_multi_test::App;

// create the default chain simulator
let mut app = App::default();

// 'generate' custom block
app.update_block(|block| {
    block.time = block.time.plus_days(6);
    block.height += 10000;
});

// get the block properties after updating
let block = app.block_info();

// now the block height is 10000 after the initial value
assert_eq!(22345, block.height);

// now the block timestamp is 6 days after the initial value
// current value is:   Wed Oct 23 2019 02:23:44 GMT+0000
// initial value was:  Tue Oct 29 2019 02:23:39 GMT+0000
assert_eq!(1572315819879305533, block.time.nanos());

// chain identifier remains unchanged
assert_eq!("cosmos-testnet-14002", block.chain_id);
```
