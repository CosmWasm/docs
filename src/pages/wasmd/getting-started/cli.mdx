# Interact via the CLI

## Tx commands

### Upload code

You can upload your contract by running the following command. In this example
we upload the `hackatom.wasm` contract.

```sh
RESP=$(wasmd tx wasm store "./x/wasm/keeper/testdata/hackatom.wasm" \
  --from alice \
  --gas 1500000 \
  -y \
  --chain-id=docs-chain-1 \
  -o json \
  --keyring-backend=test)

sleep 6

RESP=$(wasmd q tx $(echo "$RESP"| jq -r '.txhash') -o json)
CODE_ID=$(echo "$RESP" | jq -r '.events[]| select(.type=="store_code").attributes[]| select(.key=="code_id").value')

# Print code id
echo "* Code id: $CODE_ID"
```

### Create a new contract instance

You can instantiate the code uploaded in the previous step with the following
command:

```sh
ALICE_ADDR=$(wasmd keys show alice -a --keyring-backend=test)
BOB_ADDR=$(wasmd keys show bob -a --keyring-backend=test)
INIT="{\"verifier\":\"$ALICE_ADDR\", \"beneficiary\":\"$BOB_ADDR\"}"

RESP=$(wasmd tx wasm instantiate "$CODE_ID" "$INIT" \
  --admin="$ALICE_ADDR" \
  --from alice \
  --amount="100stake" \
  --label "local0.1.0" \
  --gas 1000000 \
  -y \
  --chain-id=docs-chain-1 \
  -b sync \
  -o json \
  --keyring-backend=test)

sleep 6

CONTRACT=$(wasmd query wasm list-contract-by-code "$CODE_ID" -o json | jq -r '.contracts[-1]')

# Print contract address
echo "* Contract address: $CONTRACT"
```

### Create a new contract instance with predictable address

```sh
RESP=$(wasmd tx wasm instantiate2 "$CODE_ID" "$INIT" 10 \
  --admin="$ALICE_ADDR" \
  --from alice \
  --amount="100stake" \
  --label "local0.1.0" \
  --fix-msg \
  --gas 1000000 \
  -y \
  --chain-id=docs-chain-1 \
  -b sync \
  -o json \
  --keyring-backend=test)

sleep 6

CONTRACT_PREDICTABLE=$(wasmd query wasm list-contract-by-code "$CODE_ID" -o json | jq -r '.contracts[-1]')

# Print contract address
echo "* Contract address: $CONTRACT_PREDICTABLE"
```

### Execute a command on a wasm contract

To execute a command on a wasm contract you can run the following commands:

```sh
echo "## Execute contract $CONTRACT"

MSG='{"release":{}}'

RESP=$(wasmd tx wasm execute "$CONTRACT" "$MSG" \
  --from alice \
  --gas 1000000 \
  -y \
  --chain-id=docs-chain-1 \
  -b sync \
  -o json \
  --keyring-backend=test)

sleep 6

wasmd q tx $(echo "$RESP"| jq -r '.txhash') -o json | jq
```

### Migrate a wasm contract to a new code version

```sh
echo "## Migrate contract"
echo "### Upload new code"

RESP=$(wasmd tx wasm store "./x/wasm/keeper/testdata/burner.wasm" \
  --from alice \
  --gas 1100000 \
  -y \
  --chain-id=docs-chain-1 \
  --node=http://localhost:26657 \
  -b sync \
  -o json \
  --keyring-backend=test)

sleep 6

RESP=$(wasmd q tx $(echo "$RESP" | jq -r '.txhash') -o json)
BURNER_CODE_ID=$(echo "$RESP" | jq -r '.events[] | select(.type=="store_code").attributes[] | select(.key=="code_id").value')

echo "### Migrate to code id: $BURNER_CODE_ID"

DEST_ACCOUNT=$(wasmd keys show bob -a --keyring-backend=test)

RESP=$(wasmd tx wasm migrate "$CONTRACT" "$BURNER_CODE_ID" "{\"payout\": \"$DEST_ACCOUNT\"}" \
  --from alice \
  --chain-id=docs-chain-1 \
  -b sync \
  -y \
  -o json \
  --keyring-backend=test)

sleep 6

wasmd q tx $(echo "$RESP" | jq -r '.txhash') -o json | jq
```

### Submit proposal

```sh
wasmd start
```

### Update instantiate config

```sh
wasmd start
```

### Set contract label

```sh
wasmd start
```

### Set contract admin

```sh
wasmd start
```

### Clear contract admin

```sh
wasmd start
```

### Clear contract admin

```sh
wasmd start
```

### Grant code upload permissions

```sh
wasmd start
```

### Grant contract execute permissions

```sh
wasmd start
```

### Grant contract migrate permissions

```sh
wasmd start
```

## Query commands

### Query wasm bytecode

```sh
wasmd start
```

### Query code id metadata

```sh
wasmd start
```

### Query contract metadata

```sh
wasmd start
```

### Query contract history

```sh
wasmd start
```

### Query contract state

```sh
wasmd start
```

### Query libwasmvm version

```sh
wasmd start
```

### Query codes

```sh
wasmd start
```

### Query contracts by code id

```sh
wasmd start
```

### Query contracts by creator

```sh
wasmd start
```

### Query parameters

```sh
wasmd start
```

### Query pinned contracts

```sh
wasmd start
```
